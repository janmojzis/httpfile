.TH httpfile 1
.SH NAME
httpfile \- A simple HTTP server for publishing static content
.SH SYNOPSIS
\fBhttpfile\fR [ options ] \fIroot\fR
.SH DESCRIPTION
\fBhttpfile\fR is HTTP server derived from \fBpublicfile\fR (https://cr.yp.to/publicfile.html)
.SH OPTIONS
.TP
.B \-v
Enable verbose mode. Multiple \-v options increase the verbosity. The maximum is 3.
.TP
.B \-t \fIseconds\fR
Set the request timeout to seconds \fIseconds\fR. (default 30).
.TP
.B \-T \fIseconds\fR
Set the write timeout to the network to seconds \fIseconds\fR. (default 60).
.TP
.B \-u \fIuser\fR
Run \fBhttpfile\fR under a specified \fIuser\fR's uid and gid.
.TP
.B \-h \fIcustom header\fR
Add \fIcustom header\fR to the HTTP response. The maximum is 8 \fIcustom header\fRs.
.TP
.I root
run chrooted in the directory \fIroot\fR.
.SH ENVIRONMENT
.TP
.B \fIUID/GID\fR run under the uid and gid specified by the $UID and $GID environment variables
.SH INTERFACE
.TP
most \fBhttpfile\fR properties are inherited from publicfile-0.76
.TP
\fBhttpfile\fR prints requested public files from the \fIroot\fR directory hierarchy. Normally root is /var/www/httpfile.
.PP
\fBhttpfile\fR accepts GET and HEAD requests on standard input in HTTP/1.0, and HTTP/1.1 formats, and responds on standard output:
.RS 4
.nf
HTTP/1.0: \fBhttpfile\fR prints an HTTP/1.0 header and the requested file. Then it exits.
HTTP/1.1: \fBhttpfile\fR prints an HTTP/1.1 header and the requested file. Then it waits for further requests.
.fi
.RE
.TP
If the file is unopenable or if \fBhttpfile\fR does not like the request, runs out of memory, encounters an I/O error, or does not receive an input packet within \fIrequest seconds\fR seconds, \fBhttpfile\fR prints an error message and exits.
.TP
\fBhttpfile\fR also prints local log information on standard error.
.TP
\fBhttpfile\fR has exact-prefix support for If-Modified-Since: it uses code 304 if the Last-Modified contents are an exact prefix of the If-Modified-Since contents.
.TP
\fBhttpfile\fR accepts range requests.
.TP
\fBhttpfile\fR support basic authentication see BASIC AUTHORIZATION.
.TP
Normally \fBhttpfile\fR is run under tcpserver/inetd/systemd/... to handle HTTP connections from hosts around the Internet.
.SH FILE HANDLING
.TP
A request for http://<host>/<file> refers to the file named ./<host>/<file> inside the \fIroot\fR directory hierarchy, if <file> does not end with a slash.
.TP
A request for http://<host>/<dir>/ refers to the file named ./<host>/<dir>/index.html.
.TP
\fBhttpfile\fR always converts the host name v to lowercase. If HTTP/1.0 requests do not specify a host name; in this case \fBhttpfile\fR uses the host name '0'.
.TP
A request for http://<host>/<dir> is redirected to http://<host>/<dir>/, which refers to the file named ./<host>/<dir>/index.html.
.SH BASIC AUTHORIZATION
.TP
\fBhttpfile\fR supports basic authentication using a special file (e.g. named pipe) trick.
.TP
A request for http://<host>/<dir>/<specialfile> returns HTTP response 401. Browser than sends request with authorization header "Authorization: Basic <base64_credentials>".
.TP
Then request for http://<host>/<file> refers to the file named ./@<base64_credentials_without_'='_pading>/<host>/<file>.
.SH EXAMPLES
.PP
Run httpfile using tcpserver/busybox/inetd on port 80 under user nobody and with root directory /var/www/httpfile.
.RS 4
.nf
tcpserver -HRDl0 0 80 httpfile -u nobody /var/www/httpfile
busybox tcpsvd 0 80 httpfile -u nobody /var/www/httpfile
inetd.conf line: http stream tcp nowait root /usr/bin/httpfile httpfile -u nobody /var/www/httpfile
.fi
.RE
.PP
Add headers to prohibit browser caching
.RS 4
.nf
 ... httpfile -h 'Expires: -1' -h 'Cache-Control: must-revalidate, private' ...
.fi
.RE
.PP
Add HSTS header
.RS 4
.nf
 ... httpfile -h 'Strict-Transport-Security: max-age=63072000; includeSubDomains; preload' ...
.fi
.RE
.SH DIFFERENCE COMPARED TO PUBLICFILE
.RS 0
.nf
source code rewritten from scratch
removed ftpd
added range support
added 301 redirect for directories
added basic authentication as a simple protection against robots
name changed to 'httpfile'
.fi
.SH SEE ALSO
.BR systemd.socket (5),
.BR inetd (8),
.BR tcpserver (1)
.sp
.nf
https://cr.yp.to/publicfile.html
.fi
